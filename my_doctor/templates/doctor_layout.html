{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Doctor Plus - Doctor</title>

        <link rel="stylesheet" href="{% static 'vendors/bootstrap/dist/css/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/font-awesome/css/font-awesome.min.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/themify-icons/css/themify-icons.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/flag-icon-css/css/flag-icon.min.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/selectFX/css/cs-skin-elastic.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}">
        
        <link
  rel="stylesheet"
  href="{% static 'assets/css/b4vtabs.css' %}"
/>
        <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
        <link rel="stylesheet" href="{% static 'assets/css/toastr.min.css' %}">
        <link rel="stylesheet" href="{% static 'assets/css/file.css' %}">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'></head>
<style>
    aside.left-panel{
        background-color: #ffffff;
    }
    .navbar .navbar-nav li > a{
        background-color: #ffffff;
        color: #000000!important;
    }
    .navbar .navbar-nav li.active .menu-icon,
      .navbar .navbar-nav li:hover,
      .navbar .navbar-nav li {
        color: #000000 !important; }
    .navbar{
        background-color: #ffffff;
        color: #000000 !important;
    }
    .navbar .navbar-nav li > a .menu-icon{
        color: #000000 !important;
    }
    .navbar .navbar-nav li > a:hover,
        .navbar .navbar-nav li > a:hover .menu-icon {
          color: #000 !important; }
</style>
        <body >
    {% include 'partials/_docNavbar.html'%}
    <div id="right-panel" class="right-panel">
        <header id="header" class="header">
            <div class="header-menu">
                <div class="col-md-4 mt-2">
                    <h5>Good Afternoon!</h5>
                </div>
                <div class="col-sm-8">
                    <div class="float-right ml-2">
                        <h5 id="doctorName"> </h5>
                        <small id="doctorSpecialist"></small>
                    </div>
                    <div class="user-area dropdown float-right">
                
                        <a href="#">
                
                            <img class="user-avatar rounded-circle" src="{% static 'images/admin.jpg' %}" alt="User Avatar" id="profileImage">
                
                        </a>
                
                    </div>
                
                    <div class="language-select dropdown" id="language-select">
                        <a class="dropdown-toggle" href="#" data-toggle="dropdown" id="language" aria-haspopup="true"
                            aria-expanded="true">
                            <i class="fa fa-bell"></i>
                        </a>
                    </div>
                    <div class="language-select dropdown" id="language-select">
                        <a href="/login">
                            <i class="fa fa-sign-out"></i>
                        </a>
                    </div>
                
                </div>
            </div>
      
      
        </header>
        {% block content%} {% endblock %}
        </div>
        <div class="modal calling-modal CallDialogFullscreen-sm" id="incomingVideoCall" tabindex="-1" role="dialog" aria-labelledby="incomingVideoCall" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="user-avatar user-avatar-rounded user-avatar-xl">
                                <img src="/media/logos/anonymous-user.png" alt="">
                            </div>
                            <div class="userprofile-name">
                                <span>Incoming Call</span>
                                <h4 id="PatientName"></h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col">
                                <button class="btn btn-danger btn-block" id="hangupBtn"><i class="fa fa-phone" style="transform: rotate(140deg)"></i> Ignore</button>
                            </div>
                            <div class="col">
                                <a id="answerCall" class="btn btn-success btn-block" ><i class="fa fa-phone"> Accept</i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <audio id="myAudio">
            <source src="{% static 'video/skype_ringtone.mp3' %}" type="audio/mpeg">
            Your browser does not support the audio element.
          </audio>
          
    <script src="{% static 'patients/assets/vendors/jquery/jquery-3.4.1.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery.cookie.js' %}"></script>
    <script src="{% static 'assets/js/toastr.min.js' %}"></script>
    <script src="{% static 'assets/js/file.js' %}"></script>
    <script src="{% static 'assets/js/jquery.validate.min.js' %}"></script>
    
    <script src="{% static 'vendors/popper.js/dist/umd/popper.min.js'%}"></script>
    <script src="{% static 'vendors/bootstrap/dist/js/bootstrap.min.js'%}"></script>
    <script src="{% static 'assets/js/main.js'%}"></script>
    <script src="{% static 'assets/js/bootbox.all.min.js'%}"></script>

    <script src="{% static 'vendors/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js' %}"></script>
    <script src="{% static 'vendors/jszip/dist/jszip.min.js' %}"></script>
    <script src="{% static 'vendors/pdfmake/build/pdfmake.min.js' %}"></script>
    <script src="{% static 'vendors/pdfmake/build/vfs_fonts.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-buttons/js/buttons.print.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>
    <script src="{% static 'assets/js/crud.js'%}"></script>
    {% block scripts%} {% endblock %}
    <script>
        function checkForCall() {
            
            jQuery.ajax({
                'url': '/api/vedioChatOparetion/?user=doc',
                'contentType': 'application/json',
                'async': false,
                'method': 'GET',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
                },
            }).done((response) => {
                console.log(response)
                var list = response;
                var x = document.getElementById("myAudio");
                if (list && list.length > 0) {
                    x.loop = true;
                    x.play()
                    jQuery('#hangupBtn').attr('data-id', list[0].id)
                    jQuery('#PatientName').html(list[0].caller_name)
                    jQuery('#answerCall').attr('href', `/api/VideoCall?session=${list[0].id}&user=doc&patient=${list[0].caller_ID}`)
                    jQuery('#incomingVideoCall').modal('show')
                }
                else
                {
                    jQuery('#incomingVideoCall').modal('hide')
                }
            });

        }

        jQuery('#hangupBtn').click(function () {
            jQuery.ajax({
                'url': '/api/vedioChatOparetion/' + jQuery(this).attr('data-id') +'/',
                'method': 'DELETE',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
                },
            }).done((response) => {
                console.log(response)
                var x = document.getElementById("myAudio");
                x.pause();
                x.currentTime = 0;
                jQuery('#incomingVideoCall').modal('hide')
            }).fail((response) => {
                console.log(response)
            })
        })

        setInterval(function () {
            checkForCall();
        }, 2000); 


        jQuery.ajax({
            url: '/api/getLoggedInDoctor',
            method: 'GET',
            contentType: 'application/json',
            async: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        }).done((response) => {
            console.log(response)
            jQuery('#doctorName').html('Dr. '+response.full_name)
            jQuery('#doctorSpecialist').html(response.specialist_type)
            jQuery('#profileImage').attr('src',!response.profile_pic||response.profile_pic==''?'/media/logos/anonymous-user.png':response.profile_pic)
        }).fail((error) => {
            console.log(error);
        });
    </script>
</body>
<!-- Sidebar -->


</html>