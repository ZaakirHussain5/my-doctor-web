{% extends 'new_patient_layout.html'%}
{% load static%}
{% block content %} 
<div class="ca-content__chatstab">
                        
    <div class="ca-content__callstab">
        <div class="conversation-panel__body ps">
            <div class="container">
                <div class="card">
                    <div class="card-header">
                        <h4>Select a Plan</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>Unlimited for 20 Days</h4>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group ">
                                            <li class="text-center font-weight-bold list-group-item">
                                                For an Individual
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Only one Time
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Personalized Consult
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Discount on Lab test
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card-footer">
                                        <div class="text-center">
                                            <div class="card-body text-center">
                                                <h2>
                                                    <i class="mdi mdi-currency-inr"></i> 2600.00 
                                                </h2>
                                            </div>
                                        </div>
                                        <button type="button" class="btn mfb-component__button--main" style="width:100%;  border-radius:30px">
                                            Select Plan
                                            </button>
                                    </div>
                                </div>

                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>Unlimited for 20 Days</h4>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group ">
                                            <li class="text-center font-weight-bold list-group-item">
                                                For a Family
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Only one Time
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Personalized Consult
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Discount on Lab test
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card-footer">
                                        <div class="text-center">
                                            <div class="card-body text-center">
                                                <h2>
                                                    <i class="mdi mdi-currency-inr"></i> 5000.00 
                                                </h2>
                                            </div>
                                        </div>
                                        <button type="button" class="btn mfb-component__button--main" style="width:100%;  border-radius:30px">
                                            Select Plan
                                            </button>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>Unlimited for 80 Days</h4>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group ">
                                            <li class="text-center font-weight-bold list-group-item">
                                                For a Family
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Only one Time
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Personalized Consult
                                            </li>
                                            <li class="text-center font-weight-bold list-group-item">
                                                Discount on Lab test
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="card-footer">
                                        <div class="text-center">
                                            <div class="card-body text-center">
                                                <h2>
                                                    <i class="mdi mdi-currency-inr"></i> 8600.00 
                                                </h2>
                                            </div>
                                        </div>
                                        <button type="button" class="btn mfb-component__button--main" style="width:100%;  border-radius:30px">
                                            Select Plan
                                            </button>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function(){
        $('#caMainTab a[href="{% url "patients:appointments"%}"]').addClass('active');
        // VARIABLES...
        let dataList = [];
        let old_active_id = null;


        function getAppoinmentList(){
            $.ajax({
                'url': '/api/getPatientsAppointments/',
                'contentType': 'application/json',
                'async': false,
                'method': 'GET',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Token " + $.cookie('Token'));
                },
            }).done((response)=>{
                console.log('response response', response);
                dataList = response;
            });
            console.log('data list is', dataList);
            let totalLi = '';
            for(var i=0; i < dataList.length; i++){
                let data = dataList[i];
                const liDesign = `<li id="patient${data.id}"><div class="calllist" id="patientDiv${data.id}">
                            <div class="user-avatar user-avatar-rounded online">
                                <img src="${data.doctor.profile_pic}" alt="">
                            </div>
                            <div class="calllist__details">
                                <div class="calllist__details--name">${data['doctor']['full_name']}</div>
                                <div class="calllist__details--info">
                                    <span><i class="mdi mdi-call-received"></i></span>
                                    <span>${data.appointment_date} at ${data.appointment_time}</span>
                                </div>
                            </div>
                            <div class="calllist__actions">
                                <div class="iconbox btn-hovered-light">
                                    <i class="iconbox__icon mdi mdi-video-outline"></i>
                                </div>
                            </div>
                        </div>
                    </li>`;
                totalLi += liDesign;
            }
            $('#appointment_list').html(totalLi);
            const liId = 'patient' + dataList[0].id;
            appoinmentList(liId);
        }
        getAppoinmentList()


        function appoinmentList(id){

            let ID= id.slice(7)
            $('#'+id+' #patientDiv'+ID).addClass('active');
            if(old_active_id == null){
                old_active_id = '#patientDiv'+ID;
            }
            else{
                $(old_active_id).removeClass('active');
                old_active_id = '#patientDiv'+ID;
            }

            for(let i=0; i< dataList.length; i++){
                const index = dataList[i];
                if(index.id == ID){
                    $("#doctor_image").attr('src', index.doctor.profile_pic);
                    $(".ca-profile-name").html(index.doctor.full_name);
                    $("#specialist__at").html(index.doctor.specialist_type);
                    $("#speciality_at").html(index.doctor.specialist_type);
                    $("#doctor_phone").html(index.doctor.phone_number);
                    //$("#doctor_email").html(index.doctor.phone_number);
                    $("#appointment_date").html(index.appointment_date);
                    $("#appontment_time").html(index.appointment_time);
                }
            }

        }

        $('#appointment_list').on('click', 'li', function(){
            let id = $(this).attr('id');
            return appoinmentList(id)
        })
    })
</script>
{% endblock %}