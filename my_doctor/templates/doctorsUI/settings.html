{% extends 'doctor_layout.html' %}
{% block content%}
<div class="breadcrumbs">
    <div class="col-12">
        <div class="page-header ">
            <div class="page-title p-2">
                <h4 id="title">Settings</h4>
            </div>
        </div>
    </div>
  </div>
<div class="content">
    <div class="card pl-3 pr-3">
        <div class="card-body card-block">
            <div class="row">
                <div class="col-md-12">
                     <ul class="nav nav-tabs nav-fill nav-pills mb-3" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active show" id="pills-home-tab" data-toggle="pill" href="#profile"
                                    role="tab" aria-controls="pills-home" aria-selected="true">Avalablity</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#password"
                                    role="tab" aria-controls="pills-profile" aria-selected="false">Password</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#Consultation-fee" role="tab"
                                    aria-controls="pills-contact" aria-selected="false">Consultation Fees</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#bankDetails" role="tab"
                                    aria-controls="pills-contact" aria-selected="false">Bank Details</a>
                            </li>
                        </ul> 
                    <div class="tab-content" id="myTabContent">
                    
                        <div class="tab-pane fade active show" id="profile" role="tabpanel" aria-labelledby="list">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card-header">
                                <h5>Select Day</h5>
                            </div>
                            <ul class="nav nav-tabs nav-pills left-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#tab-panel-1" data-toggle="tab">Monday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-2" data-toggle="tab">Tuesday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-3" data-toggle="tab">Wednesday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-3" data-toggle="tab">Thursday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-3" data-toggle="tab">Friday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-3" data-toggle="tab">Saturday</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#tab-panel-3" data-toggle="tab">Sunday</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-8">
                            <div class="card-header">
                                <h5>Update Availablity</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <div class=" form-group col">
                                                <label style="vertical-align: middle" class="switch switch-default switch-pill switch-success mr-2">
                                                    <input type="checkbox" id="thu" name="thu" data-id='${row.id}' class="switch-input active">
                                                    <span class="switch-label"></span>
                                                    <span id="thuday" class="switch-handle"></span> </label>Available Monday
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class=" form-group">
                                            <label for="from_time" class=" form-control-label">From</label>
                                            <input type="time" id="from_time" name="from_time" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class=" form-group">
                                            <label for="to_time" class=" form-control-label">To</label>
                                            <input type="time" id="to_time" name="to_time" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-12 d-flex flex-wrap justify-content-center">
                                        <button type="submit" class="btn btn-primary btn-sm ju">
                                            <i class="fa fa-dot-circle-o"></i> Update Timings
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                            
                              
                              
                        </div>
                    
                    
                        <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="list">
                            <div class="row">
                                <div class="col-md-8 offset-md-2">
                                    <form id="password_form">
                                <div class="row form-group">
                                    <div class="col col-md-4"><label for="old_password" class="form-control-label float-right">Old
                                            Password</label></div>
                                    <div class="col-12 col-md-8">
                                        <input type="password" id="old_password" name="old_password" placeholder="Old Passowrd"
                                            class="form-control">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col col-md-4"><label for="new_password" class=" form-control-label float-right">New
                                            Password</label></div>
                                    <div class="col-12 col-md-8"><input type="password" id="new_password" name="new_password"
                                            placeholder="New Password" class="form-control">
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col col-md-4"><label for="confirm_new_password"
                                            class=" form-control-label float-right">Confirm Password</label>
                                    </div>
                                    <div class="col-12 col-md-8"><input type="password" id="confirm_new_password"
                                            name="confirm_new_password" placeholder="Confirm Password" class="form-control"></div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-12 col-md-8 offset-md-4">
                                        <button type="submit" class="btn btn-primary btn-sm">
                                            <i class="fa fa-lock"></i> Update Password
                                        </button>
                                    </div>
                                </div>
                            </form>
                                </div>
                            </div>
                            
                        </div>
                    
                    
                        <div class="tab-pane fade" id="Consultation-fee" role="tabpanel" aria-labelledby="list">
                            <div class="row">
                                <div class="col-md-10 offset-md-1">
                                    <form id="ConsultationFeeForm">
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="old_password" class="form-control-label float-right">
                                                        Current Consultation Fee</label></div>
                                                <div class="col-12 col-md-7">
                                                    <input type="number" id="old_fee" name="old_password" placeholder="Current Cunsultation Fee"
                                                        class="form-control" value="500.00">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        New Consultation Fee</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter New Cunsultation Fee" class="form-control">
                                                </div>
                                            </div>
                                        <div class="row form-group">
                                            <div class="col-md-7 offset-md-5 ">
                                                    <button type="submit" class="btn btn-primary btn-sm ju">
                                                        <i class="fa fa-inr"></i> Update Consultation Fee
                                                    </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                        </div>
                        <div class="tab-pane fade" id="bankDetails" role="tabpanel" aria-labelledby="list">
                            <div class="row">
                                <div class="col-md-10 ">
                                    <form id="ConsultationFeeForm">
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="old_password" class="form-control-label float-right">
                                                        A/c No.</label></div>
                                                <div class="col-12 col-md-7">
                                                    <input type="number" id="old_fee" name="old_password" placeholder="Enter yout Account Number"
                                                        class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        A/c Holder Name</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter the Name Linked with the Account" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        Bank Name</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter the Bank Name" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        Branch Name</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter the Branch Name" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        IFSC</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter the IFSC" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        UPI ID</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter UPI ID" class="form-control">
                                                </div>
                                            </div>
                                            <div class="row form-group">
                                                <div class="col col-md-5"><label for="new_password" class=" form-control-label float-right">
                                                        Phone Number</label></div>
                                                <div class="col-12 col-md-7"><input type="number" id="new_fee" name="new_password"
                                                        placeholder="Enter the Phone Number" class="form-control">
                                                        <small>Phone Number which is linked with Google Pay,Phone pe or other UPI apps.</small>
                                                </div>
                                            </div>
                                        <div class="row form-group">
                                            <div class="col-md-7 offset-md-5">
                                                    <button type="submit" class="btn btn-primary btn-sm ju">
                                                        <i class="fa fa-building"></i> Update Details
                                                    </button>
                            
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                        </div>
                    </div>

            </div>
        </div>
    </div>
    <div class="card-footer">
        <div class="pull-right">

        </div>

    </div>
</div>

{% endblock %}

{% block scripts%}
<script>
    let dataList = [];
    function getDataa() {
        console.log('here')
        const form = document.getElementById('profile_form');
        jQuery.ajax({
            url: '/api/getLoggedInDoctor',
            method: 'GET',
            contentType: 'application/json',
            async: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        }).done((response) => {
            console.log('response response', response);
            formDeserialize(form, response.user);
            formDeserialize(form,response)

        }).fail((error) => {
            console.log(error);
        });
    }
    getDataa()


    function formDeserialize(form, data) {
        const entries = (new URLSearchParams(data)).entries();
        for (const [key, val] of entries) {
            const input = form.elements[key];
            if (input != undefined) {
                if (input.type == 'file') {
                    if (val) {
                        var $file = jQuery('#' + input.id),
                            $label = $file.next('label'),
                            $labelText = $label.find('span'),
                            labelDefault = $labelText.text();
                        var filename = val.split('/').pop()
                        if (filename) {
                            $label
                                .addClass('file-ok')
                                .css('background-image', 'url(' + val + ')');
                            $labelText.text('Click here to change pic');
                        } else {
                            $label.removeClass('file-ok');
                            $labelText.text(labelDefault);
                        }
                    }

                } else {

                    switch (input.type) {
                        case 'checkbox':
                            input.checked = !!val;
                            break;
                        case 'select-one':
                            if (val)
                                input.value = val;
                            else
                                input.selectedIndex = 0;

                            break;
                        default:
                            input.value = val;
                            break;

                    }

                }
            }

        }
    }


    //////////////// username change event ////////////////
   


    //////// UPDATING PROFILE //////////
    jQuery("#profile_form").submit((e) => {
        e.preventDefault();
        e.stopImmediatePropagation();
        const data = new FormData(document.getElementById('profile_form'))
        console.log(data);
        jQuery.ajax({
            url: '/api/DoctorUpdateProfile',
            data: data,
            method: 'POST',
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        })
            .done((response) => {
                console.log("postrequest response -", response);
                jQuery.removeCookie('DoctorToken');
                jQuery.cookie('DoctorToken', response.token, { expires: 1 })
                toastr.success("Your details have been Updated Successfully","Profile Updated",{positionClass:"toast-top-center"})
            })
            .fail((error) => {
                console.log(error);
            })
    })


    jQuery('#pills-profile-tab').click(() => {

    })

    ////////// PASSWORD CHANGE FEATURES //////////
    jQuery('#password_form').submit((e) => {
        e.preventDefault();
        e.stopImmediatePropagation();
        const data = new FormData(document.getElementById('password_form'))
        jQuery.ajax({
            url: '/api/changePassword',
            method: 'POST',
            data: data,
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        }).done((response) => {
            console.log(response);
            //jQuery.removeCookie('DoctorToken');
            //window.location.href = '/login';
        }).fail((error) => {
            console.log('errors are ', error)
        })


    })

    ///////////// Doctor Timings://///////////
    function getDoctorTimings() {
        const form = document.getElementById('timingsForm');
        jQuery.ajax({
            url: '/api/DoctorTimings',
            method: 'GET',
            contendType: 'application/json',
            async: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        })
            .done((response) => {
                console.log(response);
                console.log(form);
                if (response.length != 0) {
                    formDeserialize(form, response[0]);
                    for (var key in response[0]) {
                        if (response[0][key] !== true) {
                            let parent = jQuery("#" + key).parent()
                            parent.removeClass('switch-success');

                        }

                    }

                }
            })
            .fail((error) => {
                console.log(error)
            })
    }
    getDoctorTimings();
    jQuery('#timingsForm').submit((e) => {
        e.preventDefault();
        e.stopImmediatePropagation();
        const data = new FormData(document.getElementById('timingsForm'))
        jQuery.ajax({
            url: '/api/DoctorTimings/',
            method: 'POST',
            data: data,
            contentType: false,
            processData: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Token " + jQuery.cookie('DoctorToken'));
            },
        })
            .done((response) => {
                console.log(response);
            })
            .fail((error) => {
                console.log(error)
            })

    })

</script>
{% endblock %}